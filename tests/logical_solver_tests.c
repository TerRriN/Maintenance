#include <CUnit/Basic.h>
#include "logical_solver.h"

int init_suite(void)
{
    printf("\n");
    return 0;
}
int clean_suite(void) { return 0; }

static char test_board_empty_9[9][9] = {
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'},
    {'0','0','0', '0','0','0', '0','0','0'}
};

static char test_board_partial_9[9][9] = {
    {'5','3','0', '0','7','0', '0','0','0'},
    {'6','0','0', '1','9','5', '0','0','0'},
    {'0','9','8', '0','0','0', '0','6','0'},
    {'8','0','0', '0','6','0', '0','0','3'},
    {'4','0','0', '8','0','3', '0','0','1'},
    {'7','0','0', '0','2','0', '0','0','6'},
    {'0','6','0', '0','0','0', '2','8','0'},
    {'0','0','0', '4','1','9', '0','0','5'},
    {'0','0','0', '0','8','0', '0','7','9'}
};

static char test_board_full_9[9][9] = {
    {'5','3','4', '6','7','8', '9','1','2'},
    {'6','7','2', '1','9','5', '3','4','8'},
    {'1','9','8', '3','4','2', '5','6','7'},
    {'8','5','9', '7','6','1', '4','2','3'},
    {'4','2','6', '8','5','3', '7','9','1'},
    {'7','1','3', '9','2','4', '8','5','6'},
    {'9','6','1', '5','3','7', '2','8','4'},
    {'2','8','7', '4','1','9', '6','3','5'},
    {'3','4','5', '2','8','6', '1','7','9'}
};

static char test_board_empty_16[16][16] = {
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'}
};
//get char value, translate to int, translate back into new char value
static char test_board_partial_16[16][16] = {
    {'2','0','9','0','8','0','13','0','12','0','14','0','10','0','15','0'},
    {'4','0','15','0','3','0','9','0','13','0','8','0','16','0','14','0'},
    {'1','0','6','0','15','0','5','0','11','0','10','0','3','0','8','0'},
    {'16','0','8','0','14','0','10','0','4','0','2','0','9','0','5','0'},
    {'12','0','16','0','10','0','15','0','8','0','5','0','6','0','11','0'},
    {'6','0','1','0','5','0','8','0','9','0','4','0','14','0','3','0'},
    {'14','0','4','0','6','0','1','0','16','0','7','0','8','0','2','0'},
    {'3','0','10','0','4','0','2','0','6','0','13','0','1','0','16','0'},
    {'13','0','2','0','7','0','14','0','3','0','15','0','12','0','1','0'},
    {'5','0','14','0','2','0','12','0','10','0','11','0','15','0','7','0'},
    {'7','0','11','0','16','0','3','0','5','0','9','0','2','0','10','0'},
    {'10','0','3','0','9','0','11','0','2','0','12','0','4','0','13','0'},
    {'11','0','13','0','1','0','7','0','15','0','6','0','5','0','12','0'},
    {'15','0','7','0','12','0','6','0','1','0','16','0','11','0','9','0'},
    {'8','0','5','0','13','0','16','0','14','0','12','0','7','0','4','0'},
    {'9','0','12','0','11','0','4','0','7','0','3','0','13','0','6','0'}
};

static char test_board_full_16[16][16] = {
    {'2','11','9','5','8','16','13','4','12','3','14','7','10','6','15','1'},
    {'4','12','15','10','3','6','9','11','13','5','8','1','16','7','14','2'},
    {'1','14','6','7','15','2','5','12','11','9','10','16','3','13','8','4'},
    {'16','13','8','3','14','1','10','7','4','6','2','15','9','11','5','12'},
    {'12','2','16','9','10','14','15','13','8','1','5','3','6','4','11','7'},
    {'6','7','1','11','5','12','8','16','9','15','4','2','14','10','3','13'},
    {'14','5','4','13','6','11','1','3','16','12','7','10','8','9','2','15'},
    {'3','8','10','15','4','7','2','9','6','14','13','11','1','12','16','5'},
    {'13','9','2','16','7','8','14','10','3','4','15','6','12','5','1','11'},
    {'5','4','14','6','2','13','12','1','10','16','11','8','15','3','7','9'},
    {'7','1','11','12','16','4','3','15','5','13','9','14','2','8','10','6'},
    {'10','15','3','8','9','5','11','6','2','7','12','1','4','14','13','16'},
    {'11','10','13','14','1','9','7','8','15','2','6','4','5','16','12','3'},
    {'15','3','7','4','12','10','6','5','1','8','16','13','11','2','9','14'},
    {'8','6','5','1','13','3','16','2','14','11','12','9','7','15','4','10'},
    {'9','16','12','2','11','15','4','14','7','10','3','5','13','1','6','8'}
};

static char test_board_empty_25[25][25] = {
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'},
    {'0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0'}
};

static char test_board_partial_25[25][25] = {
    {'1','0','4','0','25','0','19','0','17','0','21','0','18','0','22','0','12','0','3','0','2','0','13','0','5'},
    {'5','0','19','0','24','0','22','0','9','0','16','0','7','0','17','0','21','0','14','0','10','0','4','0','15'},
    {'17','0','6','0','25','0','5','0','20','0','10','0','1','0','4','0','24','0','15','0','12','0','22','0','9'},
    {'16','0','21','0','12','0','2','0','11','0','5','0','15','0','12','0','20','0','22','0','9','0','25','0','3'},
    {'10','0','15','0','22','0','1','0','6','0','23','0','25','0','3','0','5','0','11','0','8','0','20','0','17'},
    {'12','0','11','0','6','0','13','0','24','0','7','0','8','0','21','0','19','0','4','0','22','0','2','0','18'},
    {'8','0','13','0','9','0','4','0','12','0','15','0','5','0','20','0','17','0','18','0','1','0','7','0','6'},
    {'4','0','14','0','7','0','3','0','21','0','25','0','23','0','13','0','16','0','5','0','16','0','11','0','12'},
    {'22','0','24','0','23','0','20','0','1','0','10','0','4','0','14','0','2','0','5','0','19','0','25','0','9'},
    {'20','0','2','0','5','0','8','0','14','0','9','0','12','0','19','0','1','0','7','0','3','0','21','0','4'},
    {'13','0','3','0','10','0','23','0','4','0','22','0','17','0','24','0','7','0','9','0','12','0','6','0','11'},
    {'14','0','1','0','12','0','16','0','15','0','2','0','20','0','10','0','4','0','17','0','21','0','5','0','22'},
    {'7','0','11','0','20','0','21','0','9','0','4','0','12','0','2','0','14','0','5','0','13','0','10','0','18'},
    {'2','0','9','0','11','0','10','0','8','0','14','0','3','0','12','0','18','0','23','0','4','0','3','0','20'},
    {'6','0','20','0','4','0','12','0','5','0','18','0','23','0','9','0','2','0','25','0','7','0','24','0','14'},
    {'21','0','12','0','16','0','10','0','3','0','24','0','9','0','11','0','6','0','14','0','8','0','5','0','19'},
    {'9','0','8','0','1','0','25','0','20','0','17','0','3','0','18','0','16','0','5','0','11','0','15','0','10'},
    {'23','0','22','0','15','0','5','0','14','0','6','0','16','0','11','0','1','0','13','0','4','0','19','0','24'},
    {'25','0','6','0','11','0','1','0','8','0','13','0','19','0','10','0','12','0','20','0','18','0','16','0','17'},
    {'3','0','17','0','19','0','15','0','23','0','11','0','25','0','5','0','21','0','8','0','7','0','1','0','13'},
    {'19','0','23','0','15','0','25','0','14','0','3','0','13','0','10','0','5','0','24','0','12','0','21','0','18'},
    {'15','0','5','0','14','0','7','0','19','0','20','0','11','0','25','0','9','0','12','0','18','0','6','0','1'},
    {'11','0','7','0','20','0','6','0','2','0','24','0','13','0','1','0','25','0','8','0','14','0','9','0','10'},
    {'18','0','25','0','2','0','14','0','13','0','4','0','21','0','5','0','23','0','6','0','15','0','8','0','3'},
    {'24','0','10','0','13','0','9','0','16','0','19','0','6','0','8','0','14','0','2','0','23','0','11','0','1'}
};

static char test_board_full_25[25][25] = {
    {'1','11','4','20','25','24','19','15','17','10','21','8','18','14','22','6','12','9','3','16','2','7','13','23','5'},
    {'5','2','19','23','24','8','22','12','9','3','16','6','7','20','17','18','21','25','14','13','10','11','4','1','15'},
    {'17','14','6','3','25','21','5','7','20','11','10','2','1','13','4','8','24','23','15','18','12','16','22','19','9'},
    {'16','7','21','8','12','4','2','13','11','23','5','19','15','24','12','10','20','17','22','1','9','6','25','14','3'},
    {'10','13','15','12','22','14','1','18','6','16','23','9','25','4','3','7','5','19','11','2','8','24','20','21','17'},
    {'12','1','11','10','6','5','13','23','24','15','7','16','8','17','21','25','19','3','4','9','22','14','2','20','18'},
    {'8','19','13','21','9','16','4','25','12','2','15','3','5','11','20','14','17','23','18','22','1','10','7','24','6'},
    {'4','17','14','18','7','9','3','22','21','19','25','1','24','2','23','5','13','20','10','6','16','15','8','11','12'},
    {'22','3','24','15','23','18','20','11','1','7','10','13','4','6','14','16','2','12','21','8','5','19','17','25','9'},
    {'20','16','2','25','5','10','8','6','14','17','9','22','12','18','19','11','1','15','7','24','3','23','21','13','4'},
    {'13','25','3','5','10','2','23','14','4','18','22','15','17','19','24','20','7','1','9','21','12','16','6','8','11'},
    {'14','23','1','24','12','19','16','8','15','6','2','7','20','25','10','3','4','13','17','11','21','9','5','18','22'},
    {'7','8','11','17','20','24','21','22','9','3','4','1','12','16','2','6','14','19','5','25','13','15','10','23','18'},
    {'2','22','9','6','11','17','10','25','8','5','14','13','20','7','3','16','12','24','18','15','23','19','4','1','3'},
    {'6','15','20','19','4','13','12','3','5','1','18','11','23','21','9','8','2','16','25','10','7','17','24','2','14'},
    {'21','18','12','2','16','7','10','13','3','1','24','22','9','4','11','15','6','20','14','17','8','23','5','25','19'},
    {'9','24','8','13','1','6','25','4','20','12','17','14','3','7','18','23','16','22','5','19','11','20','15','2','10'},
    {'23','10','22','7','15','21','5','9','18','14','6','20','16','8','11','17','1','2','13','25','4','3','19','12','24'},
    {'25','5','6','14','11','7','1','2','8','24','13','21','19','23','15','9','10','3','12','4','20','18','22','16','17'},
    {'3','20','17','4','19','22','15','16','23','14','11','12','25','10','5','2','21','18','8','24','7','6','1','9','13'},
    {'19','6','23','22','8','15','1','25','4','14','2','9','3','7','13','11','10','16','20','24','5','12','17','21','18'},
    {'15','4','5','17','14','3','7','24','19','8','20','23','11','10','25','22','9','21','12','13','18','2','6','16','1'},
    {'11','12','7','16','20','23','6','17','2','21','24','18','13','15','1','19','25','5','8','3','14','22','9','4','10'},
    {'18','9','25','1','2','11','14','10','13','22','4','12','21','16','5','24','23','7','6','17','15','20','8','19','3'},
    {'24','21','10','3','13','12','9','20','16','5','19','17','6','22','8','15','14','4','2','18','23','25','11','7','1'}
};

void test_unassigned(){
    N = 9;
    CU_ASSERT_EQUAL(count_unassigned(test_board_full_9), 0);
    CU_ASSERT_EQUAL(count_unassigned(test_board_partial_9), 51);
    CU_ASSERT_EQUAL(count_unassigned(test_board_empty_9), 81);

    N = 16;
    CU_ASSERT_EQUAL(count_unassigned(test_board_full_16), 0);
    CU_ASSERT_EQUAL(count_unassigned(test_board_partial_16), 128);
    CU_ASSERT_EQUAL(count_unassigned(test_board_empty_16), 256);

    N = 25;
    CU_ASSERT_EQUAL(count_unassigned(test_board_full_25), 0);
    CU_ASSERT_EQUAL(count_unassigned(test_board_partial_25), 312);
    CU_ASSERT_EQUAL(count_unassigned(test_board_empty_25), 625);
}

//////////////////////////////////////////////////////
int main()
{
    if (CU_initialize_registry() != CUE_SUCCESS)
        return CU_get_error();

    CU_pSuite logical_test_suite = CU_add_suite("Logical solver tests", init_suite, clean_suite);
    if ((logical_test_suite == NULL))
    {
        CU_cleanup_registry();
        return CU_get_error();
    }

    if (
        //(CU_add_test(store_test_suite, "Create and destroy store", test_create_destroy_store) == NULL) ||
        //(CU_add_test(store_test_suite, "Add and remove merchandise", test_add_remove_merch) == NULL) ||        
        (CU_add_test(logical_test_suite, "Count unassigned cells", test_unassigned) == NULL) ||
        0)
    {
        CU_cleanup_registry();
        return CU_get_error();
    }

    CU_basic_set_mode(CU_BRM_VERBOSE);
    CU_basic_run_tests();
    CU_cleanup_registry();
    return CU_get_error();
}
